<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avto Online Store</title>
    <link rel="stylesheet" href="style.css">

</head>
<body>
  <header>
    <div class="container">
      <div class="logo"><a href="index.html">–¶–ò–§–†–ê –û–î–ò–ù</a></div>
        <nav>
            <ul>
                <li><a href="AllCars.html">–í—Å–µ –º–∞—à–∏–Ω—ã</a></li>
                <li><a href="Contacs.html">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a></li>
                <li><a href="about.html">–û –Ω–∞—Å</a></li>
                <li><a href="#" id="openLoginBtn">–ü—Ä–æ—Ñ–∏–ª—å</a></li>
                <li><a href="#" id="cartBtn">–ó–∞–∫–∞–∑—ã</a></li>
            </ul>
        </nav>
    </div>
</header>
    
    <div class="product-section">
        <div class="container">
            <h2>–í—Å–µ –º–∞—à–∏–Ω—ã</h2>
            <div class="sort-controls">
              <label for="sortSelect">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:</label>
              <select id="sortSelect">
                  <option value="default">–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é</option>
                  <option value="price-asc">–¶–µ–Ω–∞: –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é</option>
                  <option value="price-desc">–¶–µ–Ω–∞: –ø–æ —É–±—ã–≤–∞–Ω–∏—é</option>
                  <option value="name-asc">–ù–∞–∑–≤–∞–Ω–∏–µ: A-Z</option>
                  <option value="name-desc">–ù–∞–∑–≤–∞–Ω–∏–µ: Z-A</option>
                  <option value="year-asc">–ì–æ–¥: –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é</option>
                  <option value="year-desc">–ì–æ–¥: –ø–æ —É–±—ã–≤–∞–Ω–∏—é</option>
              </select>
          </div>
            <div class="product-grid" id="product-grid">
                <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –±—É–¥—É—Ç —Ç—É—Ç -->
            </div>
        </div>
    </div>
        <footer>
        <div class="container">
            <div class="footer-column">
                <h3>Contact Us</h3>
                <p>123 Podolskaia Street<br>City, Country 12345</p>
                <p>Email: info@ChifraOdin.com</p>
                <p>Phone: +1 (234) 567-890</p>
            </div>
            <div class="footer-column">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="#">Home</a></li>
                    <li><a href="#">About Us</a></li>
                    <li><a href="#">Services</a></li>
                    <li><a href="#">Contact</a></li>
                    <li><a href="#">Privacy Policy</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h3>Follow Us</h3>
                <ul class="social-icons">
                    <li><a href="#"><img src="https://cdn-icons-png.flaticon.com/512/2111/2111393.png" alt="Facebook"></a></li>
                    <li><a href="#"><img src="https://cdn-icons-png.flaticon.com/512/2111/2111463.png" alt="Instagram"></a></li>
                    <li><a href="#"><img src="https://cdn-icons-png.flaticon.com/512/2111/2111646.png" alt="Twitter"></a></li>
                    <li><a href="#"><img src="https://cdn-icons-png.flaticon.com/512/2111/2111498.png" alt="YouTube"></a></li>
                </ul>
            </div>
        </div>
    </footer>
 <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Ñ–∏–ª—è (–≤ –≤–∏–¥–µ —Ñ–æ—Ä–º—ã) -->
 <div id="userProfile">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å</h2>
        <form id="profileForm">
            <div class="form-group">
                <label for="userNameDisplay">–õ–æ–≥–∏–Ω:</label>
                <input type="text" id="userNameDisplay" >
            </div>
            <div>
                <label for="userFirstNameDisplay">–ò–º—è:</label>
                <input type="text" id="userFirstNameDisplay" />
            </div>
            <div>   
                <label for="userLastNameDisplay">–§–∞–º–∏–ª–∏—è:</label>
                <input type="text" id="userLastNameDisplay" />
            </div>
            <div class="form-group">
                <label for="userEmailDisplay">Email:</label>
                <input id="userEmailDisplay" type="email" />
            </div>
            <div class="form-group">
                <label for="profilePhone">–¢–µ–ª–µ—Ñ–æ–Ω:</label>
                <input id="userPhoneNumberDisplay" type="text" />
            </div>
            <div class="form-group">
                <label for="userAdressDisplay">–ê–¥—Ä–µ—Å—Å:</label>
                <input id="userAddressDisplay" type="text" />
            </div>
            <div class="form-group">
                <label for="profilePassword">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å:</label>
                <input type="password" id="userPasswordDisplay" >
            </div>
            <button type="submit" id="saveProfileBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
        </form>
        <button id="logoutBtn">–í—ã–π—Ç–∏</button>
    </div>
</div>
<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
<div id="registerModal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
        <form id="registerForm">
            <div class="form-group">
                <label for="regUsername">–õ–æ–≥–∏–Ω:</label>
                <input type="text" id="regUsername" name="regUsername" required>
            </div>
            <div class="form-group">
                <label for="regPassword">–ü–∞—Ä–æ–ª—å:</label>
                <input type="password" id="regPassword" name="regPassword" required>
            </div>
            <div class="form-group">
                <label for="regFirstName">–ò–º—è:</label>
                <input type="text" id="regFirstName" name="regFirstName" required>
            </div>
            <div class="form-group">
                <label for="regLastName">–§–∞–º–∏–ª–∏—è:</label>
                <input type="text" id="regLastName" name="regLastName" required>
            </div>
            <div class="form-group">
                <label for="regPhone">–¢–µ–ª–µ—Ñ–æ–Ω:</label>
                <input type="text" id="regPhone" name="regPhone" required>
            </div>
            <div class="form-group">
                <label for="regEmail">Email:</label>
                <input type="email" id="regEmail" name="regEmail" required>
            </div>
            <div class="form-group">
                <label for="regAddress">–ê–¥—Ä–µ—Å:</label>
                <input type="text" id="regAddress" name="regAddress" required>
            </div>
            <button type="submit">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
            <div class="forgot-password">
                <a href="#" id="openLoginLink">–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç?</a>
            </div>
        </form>
    </div>
</div>
<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
<div id="loginModal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h2>
        <form id="loginForm">
            <div class="form-group">
                <label for="username">–õ–æ–≥–∏–Ω:</label>
                <input type="text" id="username" name="username" required>
            </div>
            <div class="form-group">
                <label for="password">–ü–∞—Ä–æ–ª—å:</label>
                <input type="password" id="password" name="password" required>
            </div>
            <button type="submit">–í–æ–π—Ç–∏</button>
            <div class="forgot-password">
                <a href="#" id="openRegisterLink">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞?</a>
            </div>
        </form>
    </div>
</div>
<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–∞–∫–∞–∑–æ–≤ -->
<div id="ordersModal" class="ordersModal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>–ú–æ–∏ –∑–∞–∫–∞–∑—ã</h2>
      <div id="ordersList">
        <!-- –°—é–¥–∞ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —Å–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ -->
      </div>
    </div>
  </div>
    <script>
 document.addEventListener('DOMContentLoaded', (event) => {
     let loadedCars = [];
     const loginModal = document.getElementById("loginModal");
     const openLoginBtn = document.getElementById("openLoginBtn");
     const closeButtons = document.getElementsByClassName("close");
     const loginForm = document.getElementById("loginForm");
     const userProfile = document.getElementById("userProfile");
     const logoutBtn = document.getElementById("logoutBtn");
     const ordersModal = document.getElementById('ordersModal');
     const closeOrdersBtn = document.querySelector('.close-orders')
     const ordersCloseBtn = document.querySelector('#ordersModal .close');;
     // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
     //console.log("–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã...");
     //checkSession();
 
     openLoginBtn.addEventListener("click", function (event) {
         event.preventDefault();
         console.log("–ö–Ω–æ–ø–∫–∞ –≤—Ö–æ–¥–∞ –Ω–∞–∂–∞—Ç–∞.");
         checkSession();
     });
 
     for (let i = 0; i < closeButtons.length; i++) {
         closeButtons[i].onclick = function () {
             console.log("–ó–∞–∫—Ä—ã—Ç–∏–µ –æ–∫–Ω–∞...");
             loginModal.style.display = "none";
             userProfile.style.display = "none";
         };
     }
 
     window.onclick = function (event) {
         if (event.target === loginModal) {
             console.log("–ù–∞–∂–∞–ª–∏ –Ω–∞ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ...");
             loginModal.style.display = "none";
             userProfile.style.display = "none";
         }
     };
 
     loginForm.onsubmit = async function (event) {
     event.preventDefault();
     console.log("–ü–æ–ø—ã—Ç–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...");
     const username = document.getElementById("username").value.trim();
     const password = document.getElementById("password").value.trim();
 
     const response = await fetch('http://localhost:3000/api/login', {
         method: 'POST',
         credentials: 'include', // üîë –ö—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –∫—É–∫–∏!
         headers: { 'Content-Type': 'application/json' },
         body: JSON.stringify({ username, password })
     });
 
     const data = await response.json();
     console.log("–û—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:", data);
 
     if (data.success) {
         loginModal.style.display = "none";  // –ó–∞–∫—Ä—ã—Ç—å –æ–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
         userProfile.style.display = "block";  // –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
         console.log("–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:", data);
         fillProfileForm(data.user);  // –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ñ–æ—Ä–º—É –¥–∞–Ω–Ω—ã–º–∏
 
         // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ localStorage
         localStorage.setItem("loggedIn", "true");
         localStorage.setItem("user", JSON.stringify(data.user));
         console.log(localStorage);
 
         // –ï—Å–ª–∏ —ç—Ç–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
         if (data.redirectToAdminPanel) {
             // —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å
             window.location.href = "adminPanel.html";
         } 
     } else {
         alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏');
     }
 };
 
     logoutBtn.onclick = async function () {
         console.log("–í—ã—Ö–æ–¥ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞...");
         await fetch('http://localhost:3000/api/logout', {
             method: 'POST',
             credentials: 'include' // –û—Ç–ø—Ä–∞–≤–∫–∞ –∫—É–∫–∏ —Å –∑–∞–ø—Ä–æ—Å–æ–º
         });
 
         localStorage.setItem("loggedIn", "false");
         localStorage.removeItem("user");
 
         userProfile.style.display = "none";  // –°–∫—Ä—ã—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
         loginModal.style.display = "block";  // –ü–æ–∫–∞–∑–∞—Ç—å –æ–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
         alert("–í—ã –≤—ã—à–ª–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞");
     };
 
     document.getElementById('saveProfileBtn').onclick = async (e) => {
     e.preventDefault();
     console.log("Local:",localStorage);
     const userStr = localStorage.getItem('user');
     if (!userStr) return alert("–û—à–∏–±–∫–∞: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω");
 
     const user = JSON.parse(userStr);
     const uid = user.CustomerID;  // –ü–æ–ª—É—á–∞–µ–º ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ localStorage
     console.log("UID",uid);
     const firstName = document.getElementById("userFirstNameDisplay").value;
     const lastName = document.getElementById("userLastNameDisplay").value;
     const username = document.getElementById("userNameDisplay").value;
     const password = document.getElementById("userPasswordDisplay").value;
     const phoneNumber = document.getElementById("userPhoneNumberDisplay").value;
     const email = document.getElementById("userEmailDisplay").value;
     const address = document.getElementById("userAddressDisplay").value;
         
     // –§–æ—Ä–º–∏—Ä—É–µ–º –æ–±—ä–µ–∫—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
     const userData = {
         CustomerID: uid,  // ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ localStorage
         FirstName: firstName,
         LastName: lastName,
         UserName: username,
         PhoneNumber: phoneNumber,
         Email: email,
         Address: address
     };
 
     // –ï—Å–ª–∏ –ø–∞—Ä–æ–ª—å –Ω–µ –ø—É—Å—Ç–æ–π, –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ –≤ –¥–∞–Ω–Ω—ã–µ
     if (password.trim() !== "") {
         userData.Password = password;
     }
 
     try {
         
         // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
         const response = await fetch('http://localhost:3000/api/updateProfile', {
             method: 'POST',
             headers: { 'Content-Type': 'application/json' },
             body: JSON.stringify(userData)
         });
 
         const result = await response.json();
 
         if (result.success) {
             alert("–ü—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª—ë–Ω!");
             // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ localStorage
             const newUserData = { ...user, ...userData };
             localStorage.setItem("user", JSON.stringify(newUserData));
             fillProfileForm(newUserData);  // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—É –Ω–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
         } else {
             alert("–û—à–∏–±–∫–∞: " + result.message);
         }
     } catch (error) {
         console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è:", error);
         alert("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö.");
     }
 };
 
 
     async function checkSession() {
         console.log("–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏ ...");
 
         // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ localStorage, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
         const loggedIn = localStorage.getItem("loggedIn");
         const user = localStorage.getItem("user");
 
         if (loggedIn === "true" && user) {
             console.log("‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω:", JSON.parse(user));
             userProfile.style.display = "block";  // –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
             loginModal.style.display = "none";  // –°–∫—Ä—ã—Ç—å –æ–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
             fillProfileForm(JSON.parse(user));  // –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ñ–æ—Ä–º—É –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
         } else {
             console.log("üîí –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω");
             loginModal.style.display = "block";  // –ü–æ–∫–∞–∑–∞—Ç—å –æ–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
             userProfile.style.display = "none";  // –°–∫—Ä—ã—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
         }
     }
 
     function fillProfileForm(user) {
     if (!user) {
         console.error("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º—ã.");
         return;
     }
 
     document.getElementById('userNameDisplay').value = user.UserName || '';
     document.getElementById('userFirstNameDisplay').value = user.FirstName || '';
     document.getElementById('userLastNameDisplay').value = user.LastName || '';
     document.getElementById('userEmailDisplay').value = user.Email || '';
     document.getElementById('userPhoneNumberDisplay').value = user.PhoneNumber || '';
     document.getElementById('userAddressDisplay').value = user.Address || '';
     document.getElementById('userPasswordDisplay').value = user.Password || '';
 }
 
 const registerModal = document.getElementById("registerModal");
 const openRegisterLink = document.getElementById("openRegisterLink");
 
 openRegisterLink.addEventListener("click", function (event) {
     event.preventDefault();
     loginModal.style.display = "none";
     registerModal.style.display = "block";
 });
 
 document.querySelectorAll(".close").forEach(btn => {
     btn.addEventListener("click", () => {
         loginModal.style.display = "none";
         userProfile.style.display = "none";
         registerModal.style.display = "none";
     });
 });
 
 window.onclick = function (event) {
     if (event.target === registerModal) {
         registerModal.style.display = "none";
     }
 };
 
 // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
 document.getElementById('registerForm').addEventListener('submit', async function(event) {
       event.preventDefault();
 
       const username = document.getElementById('regUsername').value.trim();
         const password = document.getElementById('regPassword').value.trim();
         const firstName = document.getElementById('regFirstName').value.trim();
         const lastName = document.getElementById('regLastName').value.trim();
         const phone = document.getElementById('regPhone').value.trim();
         const email = document.getElementById('regEmail').value.trim();
         const address = document.getElementById('regAddress').value.trim();
 
       // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏–Ω–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
       const checkResponse = await fetch('http://localhost:3000/api/check-username', {
         method: 'POST',
         headers: { 'Content-Type': 'application/json' },
         body: JSON.stringify({ username })
       });
 
       const checkData = await checkResponse.json();
 
       if (checkData.exists) {
         alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –ª–æ–≥–∏–Ω–æ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.');
         return;
       }
 
       // –ï—Å–ª–∏ –ª–æ–≥–∏–Ω —Å–≤–æ–±–æ–¥–µ–Ω, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
       const response = await fetch('http://localhost:3000/api/register', {
         method: 'POST',
         headers: { 'Content-Type': 'application/json' },
         body: JSON.stringify({
           username,
           password,
           firstName,
           lastName,
           phone,
           email,
           address
         })
       });
 
       const result = await response.json();
 
       if (result.success) {
         alert('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ!');
       } else {
         alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ' + result.message);
       }
     });
 
 document.getElementById('openLoginLink').addEventListener('click', function (e) {
     e.preventDefault(); // –æ—Ç–º–µ–Ω–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –ø–æ —Å—Å—ã–ª–∫–µ
     const loginModal = document.getElementById('loginModal');
     if (loginModal) {
       loginModal.style.display = 'block';
     }
   });
 });
 
 // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π
 function sortCars(cars, sortType) {
     switch(sortType) {
         case 'price-asc':
             return [...cars].sort((a, b) => a.Price - b.Price);
         case 'price-desc':
             return [...cars].sort((a, b) => b.Price - a.Price);
         case 'name-asc':
             return [...cars].sort((a, b) => {
                 const nameA = `${a.Brand} ${a.Model}`.toLowerCase();
                 const nameB = `${b.Brand} ${b.Model}`.toLowerCase();
                 return nameA.localeCompare(nameB);
             });
         case 'name-desc':
             return [...cars].sort((a, b) => {
                 const nameA = `${a.Brand} ${a.Model}`.toLowerCase();
                 const nameB = `${b.Brand} ${b.Model}`.toLowerCase();
                 return nameB.localeCompare(nameA);
             });
         case 'year-asc':
             return [...cars].sort((a, b) => a.Year - b.Year);
         case 'year-desc':
             return [...cars].sort((a, b) => b.Year - a.Year);
         default:
             return cars;
     }
 }
 
 document.addEventListener('DOMContentLoaded', () => {
    const grid = document.getElementById('product-grid');

    grid.addEventListener('click', async (event) => {
        if (event.target.classList.contains('buy-btn')) {
            const button = event.target;
            const carId = parseInt(button.dataset.carId);
            const salePrice = parseFloat(button.dataset.salePrice);
            const userStr = localStorage.getItem('user');
            if (!userStr) {
                alert("‚ö†Ô∏è –í–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç –¥–ª—è –ø–æ–∫—É–ø–∫–∏!");
                return;
            }
            const user = JSON.parse(userStr);
            const customerId = user.CustomerID;
            const employeeId = 0;

            try {
                const response = await fetch('http://localhost:3000/api/createSale', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        customerId,
                        carId,
                        salePrice,
                        employeeId
                    })
                });

                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ${response.statusText}`);
                }

                const result = await response.json();

                if (result.success) {
                    alert('‚úÖ –ü—Ä–æ–¥–∞–∂–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∞!');
                    location.reload();
                } else {
                    alert('‚ùå –û—à–∏–±–∫–∞: ' + result.message);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ:', error);
                alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä.');
            }
        }
    });
});

// 2. –û—Å—Ç–∞–≤–ª—è–µ–º renderCars —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞, –±–µ–∑ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
function renderCars(cars) {
    const grid = document.getElementById('product-grid');
    grid.innerHTML = '';

    cars.forEach(car => {
        const card = document.createElement('div');
        card.className = 'product-card';

        const imageUrl = car.Image
            ? 'data:image/png;base64,' + car.Image
            : 'https://via.placeholder.com/300x180?text=No+Image';

        card.innerHTML = `
            <img src="${imageUrl}" alt="${car.Model}">
            <h3>${car.Brand}</h3>
            <h3>${car.Model}</h3>
            <p>–ì–æ–¥: ${car.Year}</p>
            <p>–¶–≤–µ—Ç: ${car.Color}</p>
            <p>–î–≤–∏–≥–∞—Ç–µ–ª—å: ${car.EngineType}</p>
            <p>–¢—Ä–∞–Ω—Å–º–∏—Å—Å–∏—è: ${car.Transmission}</p>
            <p><strong>–¶–µ–Ω–∞: ${car.Price.toFixed(2)} $</strong></p>
            <button class="buy-btn" data-car-id="${car.CarID}" data-sale-price="${car.Price}">–ó–∞–∫–∞–∑–∞—Ç—å</button>
        `;
        grid.appendChild(card);
    });
}
 
 // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
 function showNotification(message, type = 'success') {
     const notification = document.getElementById('notification');
     notification.textContent = message;
     notification.style.backgroundColor = type === 'success' ? '#4CAF50' : '#f44336';
     notification.style.display = 'block';
     
     setTimeout(() => {
         notification.style.display = 'none';
     }, 6000);
 }
 
 // –ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
 fetch('http://localhost:3000/api/cars')
     .then(response => response.json())
     .then(data => {
         loadedCars = data;
         renderCars(loadedCars);
         
         // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
         document.getElementById('sortSelect').addEventListener('change', (e) => {
             const sortedCars = sortCars(loadedCars, e.target.value);
             renderCars(sortedCars);
         });
     })
     .catch(error => {
         console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π:', error);
         showNotification('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π', 'error');
     });
 
     document.getElementById('cartBtn').addEventListener('click', async () => {
  const userStr = localStorage.getItem('user');
  console.log("–ö–ª–∏–∫ –ø–æ –∫–æ—Ä–∑–∏–Ω–µ");
  if (!userStr) {
    alert("‚ö†Ô∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç.");
    return;
  }

  const user = JSON.parse(userStr);
  const customerId = user.CustomerID;

  try {
    const response = await fetch('http://localhost:3000/api/getUserOrders', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ customerId })
    });

    const result = await response.json();

    if (result.success) {
      const ordersList = document.getElementById('ordersList');
      ordersList.innerHTML = '';

      if (result.orders.length === 0) {
        ordersList.innerHTML = '<p>üì≠ –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤.</p>';
      } else {
        result.orders.forEach(order => {
          const div = document.createElement('div');
          div.classList.add('order-item');
          div.innerHTML = `
            <hr>
            <p><strong>–ë—Ä–µ–Ω–¥:</strong> ${order.Model}</p>
            <p><strong>–ú–æ–¥–µ–ª—å:</strong> ${order.Model}</p>
            <p><strong>–¶–µ–Ω–∞:</strong> ${order.SalePrice} ‚ÇΩ</p>
            <p><strong>–î–∞—Ç–∞:</strong> ${new Date(order.SaleDate).toLocaleString()}</p>
          `;
          ordersList.appendChild(div);
        });
      }

      ordersModal.style.display = "flex";
    } else {
      alert("‚ùå –û—à–∏–±–∫–∞: " + result.message);
    }
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–æ–≤:', error);
    alert('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤.');
  }
});
    const ordersModal = document.getElementById('ordersModal');
     const closeOrdersBtn = document.querySelector('.close-orders')
     const ordersCloseBtn = document.querySelector('#ordersModal .close');;
// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –∑–∞–∫–∞–∑–æ–≤
ordersCloseBtn.addEventListener('click', () => {
    ordersModal.style.display = "none";
});

// –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
window.addEventListener('click', (event) => {
    if (event.target === ordersModal) {
        ordersModal.style.display = "none";
    }
});

  </script>
</body>
<div id="notification" class="notification"></div>
</html>