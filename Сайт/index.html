<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>McLaren Online Store</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <header>
        <div class="container">
            <div class="logo"><a href="index.html">McLaren</a></div>
            <nav>
                <ul>
                    <li><a href="AllCars.html">All cars</a></li>
                    <li><a href="F1.html">F1</a></li>
                </ul>
            </nav>
            <div class="search-bar">
                <input type="text" placeholder="–ü–æ–∏—Å–∫...">
            </div>
            <div class="cart"><a href="#"><img class="imgprof" src="free-icon-shopping-cart-711897.png" alt=""></a></div>
            <div class="user-profile"><a href="#" id="openLoginBtn"><img class="imgprof" src="free-icon-profile-3106773.png" alt=""></a></div>
        </div>
    </header>
    <div class="featured-section">
        <div class="container">
            <h1>McLaren 720S</h1>
            <p>Experience the thrill of driving a McLaren 720S, with its powerful V8 engine and sleek design.</p>
            <button class="btn">Learn More</button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Ñ–∏–ª—è (–≤ –≤–∏–¥–µ —Ñ–æ—Ä–º—ã) -->
    <div id="userProfile">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å</h2>
            <form id="profileForm">
                <div class="form-group">
                    <label for="userNameDisplay">–õ–æ–≥–∏–Ω:</label>
                    <input type="text" id="userNameDisplay" >
                </div>
                <div>
                    <label for="userFirstNameDisplay">–ò–º—è:</label>
                    <input type="text" id="userFirstNameDisplay" />
                </div>
                <div>   
                    <label for="userLastNameDisplay">–§–∞–º–∏–ª–∏—è:</label>
                    <input type="text" id="userLastNameDisplay" />
                </div>
                <div class="form-group">
                    <label for="userEmailDisplay">Email:</label>
                    <input type="email" id="userEmailDisplay" />
                </div>
                <div class="form-group">
                    <label for="profilePhone">–¢–µ–ª–µ—Ñ–æ–Ω:</label>
                    <input type="phone" id="profilePhone" >
                </div>
                <div class="form-group">
                    <label for="profilePassword">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å:</label>
                    <input type="password" id="userPasswordDisplay" >
                </div>
                <button type="submit" id="saveProfileBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
            </form>
            <button id="logoutBtn">–í—ã–π—Ç–∏</button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
    <div id="loginModal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">–õ–æ–≥–∏–Ω:</label>
                    <input type="text" id="username" name="username" required>
                </div>
                <div class="form-group">
                    <label for="password">–ü–∞—Ä–æ–ª—å:</label>
                    <input type="password" id="password" name="password" required>
                </div>
                <button type="submit">–í–æ–π—Ç–∏</button>
                <div class="forgot-password">
                    <a href="#">–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?</a>
                </div>
            </form>
        </div>
    </div>

    <footer>
        <div class="container">
            <div class="footer-column">
                <h3>Contact Us</h3>
                <p>123 McLaren Street<br>City, Country 12345</p>
                <p>Email: info@mclaren.com</p>
                <p>Phone: +1 (234) 567-890</p>
            </div>
            <div class="footer-column">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="#">Home</a></li>
                    <li><a href="#">About Us</a></li>
                    <li><a href="#">Services</a></li>
                    <li><a href="#">Contact</a></li>
                    <li><a href="#">Privacy Policy</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h3>Follow Us</h3>
                <ul class="social-icons">
                    <li><a href="#"><img src="https://cdn-icons-png.flaticon.com/512/2111/2111393.png" alt="Facebook"></a></li>
                    <li><a href="#"><img src="https://cdn-icons-png.flaticon.com/512/2111/2111463.png" alt="Instagram"></a></li>
                    <li><a href="#"><img src="https://cdn-icons-png.flaticon.com/512/2111/2111646.png" alt="Twitter"></a></li>
                    <li><a href="#"><img src="https://cdn-icons-png.flaticon.com/512/2111/2111498.png" alt="YouTube"></a></li>
                </ul>
            </div>
        </div>
    </footer>

    <script>
       document.addEventListener('DOMContentLoaded', (event) => {
    const loginModal = document.getElementById("loginModal");
    const openLoginBtn = document.getElementById("openLoginBtn");
    const closeButtons = document.getElementsByClassName("close");
    const loginForm = document.getElementById("loginForm");
    const userProfile = document.getElementById("userProfile");
    const logoutBtn = document.getElementById("logoutBtn");

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    console.log("–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã...");
    checkSession();

    openLoginBtn.addEventListener("click", function (event) {
        event.preventDefault();
        console.log("–ö–Ω–æ–ø–∫–∞ –≤—Ö–æ–¥–∞ –Ω–∞–∂–∞—Ç–∞.");
        checkSession();
    });

    for (let i = 0; i < closeButtons.length; i++) {
        closeButtons[i].onclick = function () {
            console.log("–ó–∞–∫—Ä—ã—Ç–∏–µ –æ–∫–Ω–∞...");
            loginModal.style.display = "none";
            userProfile.style.display = "none";
        };
    }

    window.onclick = function (event) {
        if (event.target === loginModal) {
            console.log("–ù–∞–∂–∞–ª–∏ –Ω–∞ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ...");
            loginModal.style.display = "none";
            userProfile.style.display = "none";
        }
    };

    loginForm.onsubmit = async function (event) {
        event.preventDefault();
        console.log("–ü–æ–ø—ã—Ç–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...");
        const username = document.getElementById("username").value.trim();
        const password = document.getElementById("password").value.trim();

        const response = await fetch('http://localhost:3000/api/login', {
            method: 'POST',
            credentials: 'include', // üîë –ö—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –∫—É–∫–∏!
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password })
        });

        const data = await response.json();
        console.log("–û—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:", data);

        if (data.success) {
            loginModal.style.display = "none";  // –ó–∞–∫—Ä—ã—Ç—å –æ–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            userProfile.style.display = "block";  // –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
            fillProfileForm(data.user);  // –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ñ–æ—Ä–º—É –¥–∞–Ω–Ω—ã–º–∏

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ localStorage
            localStorage.setItem("loggedIn", "true");
            localStorage.setItem("user", JSON.stringify(data.user));
        } else {
            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏');
        }
    };

    logoutBtn.onclick = async function () {
        console.log("–í—ã—Ö–æ–¥ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞...");
        await fetch('http://localhost:3000/api/logout', {
            method: 'POST',
            credentials: 'include' // –û—Ç–ø—Ä–∞–≤–∫–∞ –∫—É–∫–∏ —Å –∑–∞–ø—Ä–æ—Å–æ–º
        });

        localStorage.setItem("loggedIn", "false");
        localStorage.removeItem("user");

        userProfile.style.display = "none";  // –°–∫—Ä—ã—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
        loginModal.style.display = "block";  // –ü–æ–∫–∞–∑–∞—Ç—å –æ–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        alert("–í—ã –≤—ã—à–ª–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞");
    };

    document.getElementById("saveProfileBtn").onclick = async function (event) {
        event.preventDefault();

        console.log("–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–æ—Ñ–∏–ª—è...");
        const firstName = document.getElementById("userFirstNameDisplay").value.trim();
        const lastName = document.getElementById("userLastNameDisplay").value.trim();
        const username = document.getElementById("userNameDisplay").value.trim();
        const email = document.getElementById("userEmailDisplay").value.trim();
        const password = document.getElementById("userPasswordDisplay").value.trim();

        const response = await fetch('http://localhost:3000/api/updateProfile', {
            method: 'POST',
            credentials: 'include',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ firstName, lastName, username, email, password })
        });

        const data = await response.json();
        console.log("–û—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è:", data);

        if (data.success) {
            alert("–ü—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω —É—Å–ø–µ—à–Ω–æ!");
        } else {
            alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è.");
        }
    };

    async function checkSession() {
        console.log("–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã...");

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ localStorage, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
        const loggedIn = localStorage.getItem("loggedIn");
        const user = localStorage.getItem("user");

        if (loggedIn === "true" && user) {
            console.log("‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω:", JSON.parse(user));
            userProfile.style.display = "block";  // –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
            loginModal.style.display = "none";  // –°–∫—Ä—ã—Ç—å –æ–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            fillProfileForm(JSON.parse(user));  // –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ñ–æ—Ä–º—É –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        } else {
            console.log("üîí –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω");
            loginModal.style.display = "block";  // –ü–æ–∫–∞–∑–∞—Ç—å –æ–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            userProfile.style.display = "none";  // –°–∫—Ä—ã—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
        }
    }

    function fillProfileForm(user) {
        document.getElementById("userFirstNameDisplay").value = user.firstName || '';
        document.getElementById("userLastNameDisplay").value = user.lastName || '';
        document.getElementById("userNameDisplay").value = user.username || '';
        document.getElementById("userEmailDisplay").value = user.email || '';
        document.getElementById("userPasswordDisplay").value = user.password || '';
    }
});
    </script>
</body>
</html>
