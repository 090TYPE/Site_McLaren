<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>McLaren Online Store</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <header>
        <div class="container">
          <div class="logo"><a href="index.html">–¶–ò–§–†–ê –û–î–ò–ù</a></div>
            <nav>
                <ul>
                    <li><a href="AllCars.html">–í—Å–µ –º–∞—à–∏–Ω—ã</a></li>
                    <li><a href="Contacs.html">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a></li>
                    <li><a href="about.html">–û –Ω–∞—Å</a></li>
                    <li><a href="#" id="openLoginBtn">–ü—Ä–æ—Ñ–∏–ª—å</a></li>
                    <li><a href="#" id="cartBtn">–ó–∞–∫–∞–∑—ã</a></li>
                </ul>
            </nav>
        </div>
    </header>
    <div class="featured-section">
        <div class="container">
            <h1>–ê–≤—Ç–æ—Å–∞–ª–æ–Ω –¶–ò–§–†–ê –û–î–ò–ù</h1>
            <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∞–≤—Ç–æ—Å–∞–ª–æ–Ω –¶–ò–§–†–ê –û–î–ò–ù ‚Äî –º–µ—Å—Ç–æ, –≥–¥–µ —Å—Ç–∏–ª—å, —Å–∫–æ—Ä–æ—Å—Ç—å –∏ –∫–∞—á–µ—Å—Ç–≤–æ —Å–æ–µ–¥–∏–Ω—è—é—Ç—Å—è –≤ –µ–¥–∏–Ω–æ–µ —Ü–µ–ª–æ–µ. –£ –Ω–∞—Å –≤—ã –Ω–∞–π–¥—ë—Ç–µ —Ç–æ–ª—å–∫–æ –ª—É—á—à–∏–µ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏ –ø—Ä–µ–º–∏—É–º-–∫–ª–∞—Å—Å–∞, –≤–∫–ª—é—á–∞—è –Ω–æ–≤–µ–π—à–∏–µ –º–æ–¥–µ–ª–∏ –æ—Ç McLaren, Ferrari, Lamborghini –∏ –¥—Ä—É–≥–∏—Ö –≤–µ–¥—É—â–∏—Ö –±—Ä–µ–Ω–¥–æ–≤.</p>
            <p>–ú—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ –∫–∞–∂–¥–æ–º—É –∫–ª–∏–µ–Ω—Ç—É, –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –∏ —É–¥–æ–±–Ω—É—é –æ–Ω–ª–∞–π–Ω-—Å–∏—Å—Ç–µ–º—É –∑–∞–∫–∞–∑–æ–≤. –í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –≤–µ—Å—å –∫–∞—Ç–∞–ª–æ–≥, –æ—Ñ–æ—Ä–º–ª—è—Ç—å –ø–æ–∫—É–ø–∫—É, —Å–ª–µ–¥–∏—Ç—å –∑–∞ —Å–≤–æ–∏–º–∏ –∑–∞–∫–∞–∑–∞–º–∏ –∏ —Å–≤—è–∑—ã–≤–∞—Ç—å—Å—è —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º ‚Äî –ø—Ä—è–º–æ –Ω–∞ —Å–∞–π—Ç–µ.</p>
            <p>–û—Ç–∫—Ä–æ–π—Ç–µ –¥–ª—è —Å–µ–±—è —Ä–æ—Å–∫–æ—à—å –∏ –º–æ—â—å. –í–∞—à –∏–¥–µ–∞–ª—å–Ω—ã–π –∞–≤—Ç–æ–º–æ–±–∏–ª—å —É–∂–µ –∂–¥—ë—Ç –≤–∞—Å.</p>
            <button class="btn"> <a href="AllCars.html">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–∞—Ç–∞–ª–æ–≥</a></button>
        </div>
    </div>

<section class="benefits">
    <div class="container">
        <h2>–ü–æ—á–µ–º—É –¶–ò–§–†–ê –û–î–ò–ù?</h2>
        <ul>
            <li>üõ† –ì–∞—Ä–∞–Ω—Ç–∏—è –∏ —Å–µ—Ä–≤–∏—Å –±–µ–∑ –∫–æ–º–ø—Ä–æ–º–∏—Å—Å–æ–≤</li>
            <li>üèÅ –ü–æ—Å—Ç–∞–≤–∫–∏ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π</li>
            <li>üë®‚Äçüíª –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ —Å–≤—è–∑—å —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º</li>
            <li>üöö –£—Å–∫–æ—Ä–µ–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –≤—Å–µ–π –†–æ—Å—Å–∏–∏</li>
        </ul>
    </div>
</section>

<section class="new-arrivals">
    <div class="container">
        <h2>–ù–æ–≤–∏–Ω–∫–∏ –º–µ—Å—è—Ü–∞</h2>
        <p>McLaren 720S, Ferrari Roma, Porsche 911 Turbo S ‚Äî —Å–ø–µ—Ü–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –¥–æ –∫–æ–Ω—Ü–∞ –º–µ—Å—è—Ü–∞. <a href="AllCars.html" class="btn">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a></p>
    
    </div>
</section>
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Ñ–∏–ª—è (–≤ –≤–∏–¥–µ —Ñ–æ—Ä–º—ã) -->
    <div id="userProfile">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å</h2>
            <form id="profileForm">
                <div class="form-group">
                    <label for="userNameDisplay">–õ–æ–≥–∏–Ω:</label>
                    <input type="text" id="userNameDisplay" >
                </div>
                <div>
                    <label for="userFirstNameDisplay">–ò–º—è:</label>
                    <input type="text" id="userFirstNameDisplay" />
                </div>
                <div>   
                    <label for="userLastNameDisplay">–§–∞–º–∏–ª–∏—è:</label>
                    <input type="text" id="userLastNameDisplay" />
                </div>
                <div class="form-group">
                    <label for="userEmailDisplay">Email:</label>
                    <input id="userEmailDisplay" type="email" />
                </div>
                <div class="form-group">
                    <label for="profilePhone">–¢–µ–ª–µ—Ñ–æ–Ω:</label>
                    <input id="userPhoneNumberDisplay" type="text" />
                </div>
                <div class="form-group">
                    <label for="userAdressDisplay">–ê–¥—Ä–µ—Å—Å:</label>
                    <input id="userAddressDisplay" type="text" />
                </div>
                <div class="form-group">
                    <label for="profilePassword">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å:</label>
                    <input type="password" id="userPasswordDisplay" >
                </div>
                <button type="submit" id="saveProfileBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
            </form>
            <button id="logoutBtn">–í—ã–π—Ç–∏</button>
        </div>
    </div>
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
    <div id="registerModal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
            <form id="registerForm">
                <div class="form-group">
                    <label for="regUsername">–õ–æ–≥–∏–Ω:</label>
                    <input type="text" id="regUsername" name="regUsername" required>
                </div>
                <div class="form-group">
                    <label for="regPassword">–ü–∞—Ä–æ–ª—å:</label>
                    <input type="password" id="regPassword" name="regPassword" required>
                </div>
                <div class="form-group">
                    <label for="regFirstName">–ò–º—è:</label>
                    <input type="text" id="regFirstName" name="regFirstName" required>
                </div>
                <div class="form-group">
                    <label for="regLastName">–§–∞–º–∏–ª–∏—è:</label>
                    <input type="text" id="regLastName" name="regLastName" required>
                </div>
                <div class="form-group">
                    <label for="regPhone">–¢–µ–ª–µ—Ñ–æ–Ω:</label>
                    <input type="text" id="regPhone" name="regPhone" required>
                </div>
                <div class="form-group">
                    <label for="regEmail">Email:</label>
                    <input type="email" id="regEmail" name="regEmail" required>
                </div>
                <div class="form-group">
                    <label for="regAddress">–ê–¥—Ä–µ—Å:</label>
                    <input type="text" id="regAddress" name="regAddress" required>
                </div>
                <button type="submit">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                <div class="forgot-password">
                    <a href="#" id="openLoginLink">–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç?</a>
                </div>
            </form>
        </div>
    </div>
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
    <div id="loginModal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">–õ–æ–≥–∏–Ω:</label>
                    <input type="text" id="username" name="username" required>
                </div>
                <div class="form-group">
                    <label for="password">–ü–∞—Ä–æ–ª—å:</label>
                    <input type="password" id="password" name="password" required>
                </div>
                <button type="submit">–í–æ–π—Ç–∏</button>
                <div class="forgot-password">
                    <a href="#" id="openRegisterLink">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞?</a>
                </div>
            </form>
        </div>
    </div>
    <div id="ordersModal" class="ordersModal">
        <div class="modal-content">
          <span class="close">&times;</span>
          <h2>–ú–æ–∏ –∑–∞–∫–∞–∑—ã</h2>
          <div id="ordersList">
            <!-- –°—é–¥–∞ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —Å–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ -->
          </div>
        </div>
      </div>
    <footer>
        <div class="container">
            <div class="footer-column">
                <h3>Contact Us</h3>
                <p>123 McLaren Street<br>City, Country 12345</p>
                <p>Email: info@mclaren.com</p>
                <p>Phone: +1 (234) 567-890</p>
            </div>
            <div class="footer-column">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="#">Home</a></li>
                    <li><a href="#">About Us</a></li>
                    <li><a href="#">Services</a></li>
                    <li><a href="#">Contact</a></li>
                    <li><a href="#">Privacy Policy</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h3>Follow Us</h3>
                <ul class="social-icons">
                    <li><a href="#"><img src="https://cdn-icons-png.flaticon.com/512/2111/2111393.png" alt="Facebook"></a></li>
                    <li><a href="#"><img src="https://cdn-icons-png.flaticon.com/512/2111/2111463.png" alt="Instagram"></a></li>
                    <li><a href="#"><img src="https://cdn-icons-png.flaticon.com/512/2111/2111646.png" alt="Twitter"></a></li>
                    <li><a href="#"><img src="https://cdn-icons-png.flaticon.com/512/2111/2111498.png" alt="YouTube"></a></li>
                </ul>
            </div>
        </div>
    </footer>

    <script>
       document.addEventListener('DOMContentLoaded', (event) => {
    const loginModal = document.getElementById("loginModal");
    const openLoginBtn = document.getElementById("openLoginBtn");
    const closeButtons = document.getElementsByClassName("close");
    const loginForm = document.getElementById("loginForm");
    const userProfile = document.getElementById("userProfile");
    const logoutBtn = document.getElementById("logoutBtn");

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    //console.log("–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã...");
    //checkSession();

    openLoginBtn.addEventListener("click", function (event) {
        event.preventDefault();
        console.log("–ö–Ω–æ–ø–∫–∞ –≤—Ö–æ–¥–∞ –Ω–∞–∂–∞—Ç–∞.");
        checkSession();
    });

    for (let i = 0; i < closeButtons.length; i++) {
        closeButtons[i].onclick = function () {
            console.log("–ó–∞–∫—Ä—ã—Ç–∏–µ –æ–∫–Ω–∞...");
            loginModal.style.display = "none";
            userProfile.style.display = "none";
        };
    }

    window.onclick = function (event) {
        if (event.target === loginModal) {
            console.log("–ù–∞–∂–∞–ª–∏ –Ω–∞ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ...");
            loginModal.style.display = "none";
            userProfile.style.display = "none";
        }
    };

    loginForm.onsubmit = async function (event) {
    event.preventDefault();
    console.log("–ü–æ–ø—ã—Ç–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...");
    const username = document.getElementById("username").value.trim();
    const password = document.getElementById("password").value.trim();

    const response = await fetch('http://localhost:3000/api/login', {
        method: 'POST',
        credentials: 'include', // üîë –ö—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –∫—É–∫–∏!
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, password })
    });

    const data = await response.json();
    console.log("–û—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:", data);

    if (data.success) {
        loginModal.style.display = "none";  // –ó–∞–∫—Ä—ã—Ç—å –æ–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        userProfile.style.display = "block";  // –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
        console.log("–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:", data);
        fillProfileForm(data.user);  // –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ñ–æ—Ä–º—É –¥–∞–Ω–Ω—ã–º–∏

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ localStorage
        localStorage.setItem("loggedIn", "true");
        localStorage.setItem("user", JSON.stringify(data.user));
        console.log(localStorage);

        // –ï—Å–ª–∏ —ç—Ç–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
        if (data.redirectToAdminPanel) {
            // —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å
            window.location.href = "adminPanel.html";
        } 
    } else {
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏');
    }
};

    logoutBtn.onclick = async function () {
        console.log("–í—ã—Ö–æ–¥ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞...");
        await fetch('http://localhost:3000/api/logout', {
            method: 'POST',
            credentials: 'include' // –û—Ç–ø—Ä–∞–≤–∫–∞ –∫—É–∫–∏ —Å –∑–∞–ø—Ä–æ—Å–æ–º
        });

        localStorage.setItem("loggedIn", "false");
        localStorage.removeItem("user");

        userProfile.style.display = "none";  // –°–∫—Ä—ã—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
        loginModal.style.display = "block";  // –ü–æ–∫–∞–∑–∞—Ç—å –æ–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        alert("–í—ã –≤—ã—à–ª–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞");
    };

    document.getElementById('saveProfileBtn').onclick = async (e) => {
    e.preventDefault();
    console.log("Local:",localStorage);
    const userStr = localStorage.getItem('user');
    if (!userStr) return alert("–û—à–∏–±–∫–∞: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω");

    const user = JSON.parse(userStr);
    const uid = user.CustomerID;  // –ü–æ–ª—É—á–∞–µ–º ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ localStorage
    console.log("UID",uid);
    const firstName = document.getElementById("userFirstNameDisplay").value;
    const lastName = document.getElementById("userLastNameDisplay").value;
    const username = document.getElementById("userNameDisplay").value;
    const password = document.getElementById("userPasswordDisplay").value;
    const phoneNumber = document.getElementById("userPhoneNumberDisplay").value;
    const email = document.getElementById("userEmailDisplay").value;
    const address = document.getElementById("userAddressDisplay").value;
        
    // –§–æ—Ä–º–∏—Ä—É–µ–º –æ–±—ä–µ–∫—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
    const userData = {
        CustomerID: uid,  // ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ localStorage
        FirstName: firstName,
        LastName: lastName,
        UserName: username,
        PhoneNumber: phoneNumber,
        Email: email,
        Address: address
    };

    // –ï—Å–ª–∏ –ø–∞—Ä–æ–ª—å –Ω–µ –ø—É—Å—Ç–æ–π, –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ –≤ –¥–∞–Ω–Ω—ã–µ
    if (password.trim() !== "") {
        userData.Password = password;
    }

    try {
        
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
        const response = await fetch('http://localhost:3000/api/updateProfile', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(userData)
        });

        const result = await response.json();

        if (result.success) {
            alert("–ü—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª—ë–Ω!");
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ localStorage
            const newUserData = { ...user, ...userData };
            localStorage.setItem("user", JSON.stringify(newUserData));
            fillProfileForm(newUserData);  // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—É –Ω–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
        } else {
            alert("–û—à–∏–±–∫–∞: " + result.message);
        }
    } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è:", error);
        alert("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö.");
    }
};


    async function checkSession() {
        console.log("–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏ ...");

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ localStorage, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
        const loggedIn = localStorage.getItem("loggedIn");
        const user = localStorage.getItem("user");

        if (loggedIn === "true" && user) {
            console.log("‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω:", JSON.parse(user));
            userProfile.style.display = "block";  // –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
            loginModal.style.display = "none";  // –°–∫—Ä—ã—Ç—å –æ–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            fillProfileForm(JSON.parse(user));  // –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ñ–æ—Ä–º—É –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        } else {
            console.log("üîí –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω");
            loginModal.style.display = "block";  // –ü–æ–∫–∞–∑–∞—Ç—å –æ–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            userProfile.style.display = "none";  // –°–∫—Ä—ã—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
        }
    }

    function fillProfileForm(user) {
    if (!user) {
        console.error("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º—ã.");
        return;
    }

    document.getElementById('userNameDisplay').value = user.UserName || '';
    document.getElementById('userFirstNameDisplay').value = user.FirstName || '';
    document.getElementById('userLastNameDisplay').value = user.LastName || '';
    document.getElementById('userEmailDisplay').value = user.Email || '';
    document.getElementById('userPhoneNumberDisplay').value = user.PhoneNumber || '';
    document.getElementById('userAddressDisplay').value = user.Address || '';
    document.getElementById('userPasswordDisplay').value = user.Password || '';
}

const registerModal = document.getElementById("registerModal");
const openRegisterLink = document.getElementById("openRegisterLink");

openRegisterLink.addEventListener("click", function (event) {
    event.preventDefault();
    loginModal.style.display = "none";
    registerModal.style.display = "block";
});

document.querySelectorAll(".close").forEach(btn => {
    btn.addEventListener("click", () => {
        loginModal.style.display = "none";
        userProfile.style.display = "none";
        registerModal.style.display = "none";
    });
});

window.onclick = function (event) {
    if (event.target === registerModal) {
        registerModal.style.display = "none";
    }
};

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
document.getElementById('registerForm').addEventListener('submit', async function(event) {
      event.preventDefault();

      const username = document.getElementById('regUsername').value.trim();
        const password = document.getElementById('regPassword').value.trim();
        const firstName = document.getElementById('regFirstName').value.trim();
        const lastName = document.getElementById('regLastName').value.trim();
        const phone = document.getElementById('regPhone').value.trim();
        const email = document.getElementById('regEmail').value.trim();
        const address = document.getElementById('regAddress').value.trim();

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏–Ω–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
      const checkResponse = await fetch('http://localhost:3000/api/check-username', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username })
      });

      const checkData = await checkResponse.json();

      if (checkData.exists) {
        alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –ª–æ–≥–∏–Ω–æ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.');
        return;
      }

      // –ï—Å–ª–∏ –ª–æ–≥–∏–Ω —Å–≤–æ–±–æ–¥–µ–Ω, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
      const response = await fetch('http://localhost:3000/api/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          username,
          password,
          firstName,
          lastName,
          phone,
          email,
          address
        })
      });

      const result = await response.json();

      if (result.success) {
        alert('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ!');
      } else {
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ' + result.message);
      }
    });

document.getElementById('openLoginLink').addEventListener('click', function (e) {
    e.preventDefault(); // –æ—Ç–º–µ–Ω–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –ø–æ —Å—Å—ã–ª–∫–µ
    const loginModal = document.getElementById('loginModal');
    if (loginModal) {
      loginModal.style.display = 'block';
    }
  });
  document.getElementById('cartBtn').addEventListener('click', async () => {
  const userStr = localStorage.getItem('user');
  console.log("–ö–ª–∏–∫ –ø–æ –∫–æ—Ä–∑–∏–Ω–µ");
  if (!userStr) {
    alert("‚ö†Ô∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç.");
    return;
  }

  const user = JSON.parse(userStr);
  const customerId = user.CustomerID;

  try {
    const response = await fetch('http://localhost:3000/api/getUserOrders', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ customerId })
    });

    const result = await response.json();

    if (result.success) {
      const ordersList = document.getElementById('ordersList');
      ordersList.innerHTML = '';

      if (result.orders.length === 0) {
        ordersList.innerHTML = '<p>üì≠ –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤.</p>';
      } else {
        result.orders.forEach(order => {
          const div = document.createElement('div');
          div.classList.add('order-item');
          div.innerHTML = `
            <hr>
            <p><strong>–ë—Ä–µ–Ω–¥:</strong> ${order.Brand}</p>
            <p><strong>–ú–æ–¥–µ–ª—å:</strong> ${order.Model}</p>
            <p><strong>–¶–µ–Ω–∞:</strong> ${order.SalePrice} ‚ÇΩ</p>
            <p><strong>–î–∞—Ç–∞:</strong> ${new Date(order.SaleDate).toLocaleString()}</p>
          `;
          ordersList.appendChild(div);
        });
      }

      ordersModal.style.display = "flex";
    } else {
      alert("‚ùå –û—à–∏–±–∫–∞: " + result.message);
    }
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–æ–≤:', error);
    alert('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤.');
  }
});
document.querySelector("#ordersModal .close").onclick = () => {
  document.getElementById("ordersModal").style.display = "none";
};
});
    </script>
</body>
</html>
